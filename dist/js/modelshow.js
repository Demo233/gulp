"use strict";var _BimBdip;function _defineProperty(i,e,o){return e in i?Object.defineProperty(i,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[e]=o,i}var BimBdip=(_defineProperty(_BimBdip={currentUserid:null,currentUsername:null,view:null,viewToolBar:null,button_viewpoint:null,button_panorama:null,button_share:null,button_room:null,button_history:null,button_collision:null},"button_viewpoint",null),_defineProperty(_BimBdip,"view_modelUrl",null),_defineProperty(_BimBdip,"view_modelName",null),_defineProperty(_BimBdip,"lvmid",null),_defineProperty(_BimBdip,"modelVersion",null),_defineProperty(_BimBdip,"parentId",null),_defineProperty(_BimBdip,"beUploadType",null),_defineProperty(_BimBdip,"be3DViewer",null),_defineProperty(_BimBdip,"m_count",null),_defineProperty(_BimBdip,"btnViewUrl",null),_defineProperty(_BimBdip,"sdbPath",null),_defineProperty(_BimBdip,"isSdbFinished",null),_defineProperty(_BimBdip,"button_filter",null),_defineProperty(_BimBdip,"button_filter",null),_defineProperty(_BimBdip,"button_coloring",null),_defineProperty(_BimBdip,"filter_open",null),_defineProperty(_BimBdip,"filter_run",null),_defineProperty(_BimBdip,"button_axis",null),_defineProperty(_BimBdip,"button_selectWindow",null),_defineProperty(_BimBdip,"init",function(i,e){BimBdip.currentUserid=i,BimBdip.currentUsername=e,BimBdip.viewToolBar=new Autodesk.Viewing.UI.ControlGroup("bimbdip_viewToolBar"),BimBdip.button_panorama=new Autodesk.Viewing.UI.Button("bimbdip_button_panorama"),BimBdip.button_share=new Autodesk.Viewing.UI.Button("bimbdip_button_share"),BimBdip.button_room=new Autodesk.Viewing.UI.Button("bimbdip_button_room"),BimBdip.button_history=new Autodesk.Viewing.UI.Button("bimbdip_button_history"),BimBdip.button_collision=new Autodesk.Viewing.UI.Button("bimbdip_button_collision"),BimBdip.button_viewpoint=new Autodesk.Viewing.UI.Button("bimbdip_button_viewpoint"),BimBdip.button_filter=new Autodesk.Viewing.UI.Button("bimbdip_button_filter"),BimBdip.button_coloring=new Autodesk.Viewing.UI.Button("bimbdip_button_coloring"),BimBdip.button_axis=new Autodesk.Viewing.UI.Button("bimbdip_button_axis"),BimBdip.button_selectWindow=new Autodesk.Viewing.UI.Button("bimbdip_button_selectWindow"),BimBdip.be3DViewer=!0,BimBdip.m_count=1,BimBdip.btnViewUrl="",BimBdip.filter_open=!0,BimBdip.filter_run=!1}),_defineProperty(_BimBdip,"modelLoad",function(i,e,o,t,n,d){d&&0<d.length?BimBdip.sdbPath="":BimBdip.sdbPath=BimBdip.getSDBPath(o,t);var B=!0,r=document.getElementById("viewers"),p={model:""},l=parseInt(1e8*Math.random()),m=publicJS.translocalurl(i),a=publicJS.translocaloneurl(i),u=i+"?urlId="+l,s=a+"?urlId="+l;checkLocalUrl(m+"?urlId="+l)?(B=!0,p.model=m,gotoPage("local"),BimBdip.m_count=2):checkLocalUrl(s)?(B=!0,p.model=a,gotoPage("local"),BimBdip.m_count=2):checkLocalUrl(u)?(B=!0,p.model=i,gotoPage("server"),1==BimBdip.m_count&&(jQuery("#btnChange").hide(),BimBdip.m_count=2)):(B=!1,BimBdip.m_count=1),B?(BimBdip.view_modelUrl=i,BimBdip.view_modelName=e,BimBdip.parentId=n,BimBdip.lvmid=o,BimBdip.modelVersion=t,BimBdip.sdbTurn(),BimBdip.beUploadType=d,BimBdip.view=new Autodesk.Viewing.Private.GuiViewer3D(r,{}),Autodesk.Viewing.Initializer(p,function(){BimBdip.view.initialize(),BimBdip.view.load(p.model),BimBdip.view.loadExtension("MyUIExtension"),BimBdip.view.loadExtension("Viewing.Extension.Transform"),BimBdip.view.loadExtension("Autodesk.Viewing.ZoomWindow"),BimBdip.view.fitToView(!0),BimBdip.creatViewButton(),BimBdip.view.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,function(i){BimBdip.searchDbids=new Array,BimBdip.searchall()})})):Dialog.alert("模型正在处理中，请耐心等待")}),_defineProperty(_BimBdip,"getSDBPath",function(i,e){var o="";return $.ajax({url:publicJS.tomcat_url+"/bimmodelversion/getSDBFilePath?modelid="+i+"&modelversion="+e,type:"GET",dataType:"JSON",processData:!1,contentType:!1,async:!1,success:function(i){var e=i.data;null!=e&&(1==e.sdbstatus||"1"==e.sdbstatus?(BimBdip.sdbPath=e.dbpath,BimBdip.isSdbFinished=!0,o=e.dbpath):(BimBdip.sdbPath="",BimBdip.isSdbFinished=!1))},error:function(){}}),o}),_defineProperty(_BimBdip,"localServerModels",function(i){BimBdip.view=new Autodesk.Viewing.Private.GuiViewer3D(viewerElement,{}),Autodesk.Viewing.Initializer(options,function(){BimBdip.view.initialize(),BimBdip.view.load(i),BimBdip.view.loadExtension("MyUIExtension"),BimBdip.view.loadExtension("Autodesk.Viewing.ZoomWindow"),BimBdip.view.loadExtension("Viewing.Extension.Transform"),BimBdip.view.fitToView(!0),BimBdip.creatViewButton()})}),_defineProperty(_BimBdip,"creatViewButton",function(){BimBdip.setUp_button_panorama(),BimBdip.setUp_button_share(),BimBdip.setUp_button_room(),BimBdip.setUp_button_history(),BimBdip.setUp_button_collision(),BimBdip.setUp_button_viewpoint(),BimBdip.setUp_button_filter(),BimBdip.setUp_button_coloring(),BimBdip.setUp_button_selectWindow(),BimBdip.viewToolBar.addControl(BimBdip.button_panorama),BimBdip.viewToolBar.addControl(BimBdip.button_share),BimBdip.viewToolBar.addControl(BimBdip.button_room),BimBdip.viewToolBar.addControl(BimBdip.button_history),BimBdip.viewToolBar.addControl(BimBdip.button_collision),BimBdip.viewToolBar.addControl(BimBdip.button_viewpoint),BimBdip.viewToolBar.addControl(BimBdip.button_filter),BimBdip.viewToolBar.addControl(BimBdip.button_coloring),BimBdip.viewToolBar.addControl(BimBdip.button_selectWindow),BimBdip.view.toolbar.addControl(BimBdip.viewToolBar)}),_defineProperty(_BimBdip,"setUp_button_panorama",function(){BimBdip.button_panorama.setIcon("panorama-play"),BimBdip.button_panorama.setToolTip("资料管理 "),BimBdip.button_panorama.onClick=function(i){bimPanorama.showAllPan(),bimFileterColoring.removeAllColors()}}),_defineProperty(_BimBdip,"setUp_button_share",function(){BimBdip.button_share.setIcon("share-play"),BimBdip.button_share.setToolTip("模型分享"),BimBdip.button_share.onClick=function(i){bimShare.doShare(),bimFileterColoring.removeAllColors()}}),_defineProperty(_BimBdip,"setUp_button_room",function(){BimBdip.button_room.setIcon("room-play"),BimBdip.button_room.setToolTip("模型共享交流"),BimBdip.button_room.onClick=function(i){bimRoom.doRoom(),bimFileterColoring.removeAllColors()}}),_defineProperty(_BimBdip,"setUp_button_history",function(){BimBdip.button_history.setIcon("history-play"),BimBdip.button_history.setToolTip("会话历史记录"),BimBdip.button_history.onClick=function(i){bimHistory.clean(),bimHistory.doHistory(),bimFileterColoring.removeAllColors()}}),_defineProperty(_BimBdip,"setUp_button_collision",function(){BimBdip.button_collision.setIcon("collision-play"),BimBdip.button_collision.setToolTip("碰撞点上传"),BimBdip.button_collision.onClick=function(i){bimCollision.doCollision(),bimFileterColoring.removeAllColors()}}),_defineProperty(_BimBdip,"setUp_button_viewpoint",function(){BimBdip.button_viewpoint.setIcon("viewpoint-play"),BimBdip.button_viewpoint.setToolTip("视点保存"),BimBdip.button_viewpoint.onClick=function(i){bimViewPointNew.viewpoint_load(),bimFileterColoring.removeAllColors();var e=$("#div_viewpoint");"-300px"==e.css("right")?(hideSidePanel(),window.parent.hideSidePanel(),e.css("right","0px")):e.css("right","-300px")}}),_defineProperty(_BimBdip,"setUp_button_coloring",function(){BimBdip.button_coloring.setIcon("colour"),BimBdip.button_coloring.setToolTip("过滤着色管理"),BimBdip.button_coloring.onClick=function(i){bimFileterColoring.coloring_load();var e=$(".filter_coloring_box");"-320px"==e.css("right")?(hideSidePanel(),window.parent.hideSidePanel(),e.css("right","0px")):e.css("right","-320px")}}),_defineProperty(_BimBdip,"setUp_button_filter",function(){BimBdip.button_filter.setIcon("filtration"),BimBdip.button_filter.setToolTip("过滤器"),BimBdip.button_filter.onClick=function(i){bimFileterColoring.removeAllColors(),BimBdip.filter_open?0==BimBdip.view.getSelection().length?Dialog.alert("请先选择需要过滤的模型构件！"):($(".filter_box").show(),$(".gray").show(),bimOriginFilter.initialize(),bimOriginFilter.loadTreeOther(),filterExecute.modelAttributeTypes()):BimBdip.filter_run?$.ajax({url:publicJS.tomcat_url+"/bimmodelversion/getSDBFilePath?modelid="+modelid+"&modelversion="+modelversion,type:"GET",dataType:"JSON",processData:!1,contentType:!1,async:!1,success:function(i){var e=i.data;null!=e&&(1==e.sdbstatus||"1"==e.sdbstatus?(BimBdip.filter_run=!1,BimBdip.filter_open=!0,BimBdip.sdbPath=e.dbpath):Dialog.alert("数据转化中，请稍后"))},error:function(){Dialog.log("获取sdb文件路径异常")}}):(Dialog.alert("属性文件缺失或正在处理中，请稍后或者联系客服！"),BimBdip.sdbTurn())}}),_defineProperty(_BimBdip,"onSelectionChanged",function(i){for(var e=new THREE.Vector3(-100,0,0),o=i.model,t=i.fragIdsArray,n=0;n<t.length;n++){fragProxy=BimBdip.view.impl.getFragmentProxy(o,t[n]),fragProxy.getAnimTransform();var d=new THREE.Vector3(fragProxy.position.x+e.x,fragProxy.position.y+e.y,fragProxy.position.z+e.z);fragProxy.position=d,fragProxy.updateAnimTransform()}BimBdip.view.impl.sceneUpdated(!0)}),_defineProperty(_BimBdip,"talking",function(){var i=BimBdip.view.getState(),e=JSON.stringify(i);e=e.replace(/\"/g,"'");var o="",t="";if(BimBdip.view.model.getData().instanceTree.enumNodeFragments(BimBdip.view.getSelection()[0],function(i){o=i,t=BimBdip.view.getSelection()[0]}),""!=t){var n=BimBdip.view_modelUrl,d=BimBdip.lvmid,B=new FormData;B.append("json",e),B.append("modelUrl",n),B.append("dbId",t),B.append("fragId",o),B.append("lvmid",d);var r=BimBdip.view.getScreenShotBuffer();discussCompress(B,r)}else Dialog.alert("暂不支持多构件发起实时讨论")}),_defineProperty(_BimBdip,"sdbTurn",function(){var i=new FormData,e=BimBdip.lvmid,o=BimBdip.modelVersion;i.append("lmvid",e),i.append("modelversion",o),$.ajax({url:publicJS.tomcat_url+"/attribute/sdbtrun",type:"post",data:i,processData:!1,contentType:!1,dataType:"json",success:function(i){"200"==i.code&&("none"==i.msg?BimBdip.filter_open=!1:"Done"==i.msg?(BimBdip.filter_open=!1,BimBdip.filter_run=!0):BimBdip.filter_open=!0)}})}),_defineProperty(_BimBdip,"setUp_button_axis",function(){BimBdip.checkZW&&0!=BimBdip.searchDbids.length&&(BimBdip.button_axis.setIcon("axis-net"),BimBdip.button_axis.setToolTip("轴网移动"),BimBdip.button_axis.onClick=function(i){bimAxisMove.doAxisMove()},BimBdip.view.getToolbar(!0).getControl(av.TOOLBAR.BASEMODELSHOWSID).addControl(BimBdip.button_axis))}),_defineProperty(_BimBdip,"searchall",function(){var e=0;BimBdip.view.search('"轴网"',function(i){e+=1,BimBdip.checkZW=!0,BimBdip.searchDbids=i,1==e&&BimBdip.setUp_button_axis()})}),_defineProperty(_BimBdip,"setUp_button_selectWindow",function(){BimBdip.button_selectWindow.setIcon("kuangxuan"),BimBdip.button_selectWindow.setToolTip("模型框选"),BimBdip.button_selectWindow.onClick=function(i){BimBdip.startSelection(),BimBdip.isFullScreen=!BimBdip.isFullScreen,bimSelectWindow.doSelectWindow()}}),_defineProperty(_BimBdip,"startSelection",function(){BimBdip.view.loadExtension("MySelectionWindow").then(function(i){i.init()})}),_BimBdip);