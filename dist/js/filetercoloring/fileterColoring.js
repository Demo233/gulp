"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},bimFileterColoring={beVisibleToColoring:!1,btnColoring:null,currentModelUrl:null,currentModelid:null,currentUserid:null,currentUsername:null,currentDbid:"",dbidcheck:[],isFirstClick:!0,childid:null,check_val:[],colors:[],checkName:null,getselectdbid:null,deletedbids:null,dbids:null,isFirst:null,colorClose:null,init:function(){var e=BimBdip.view.getToolbar(!0).getControl("bimbdip_viewToolBar").getControl("bimbdip_button_coloring");bimFileterColoring.btnColoring=e.container,bimFileterColoring.currentModelUrl=BimBdip.view_modelUrl,bimFileterColoring.currentModelid=BimBdip.lvmid,bimFileterColoring.currentUserid=BimBdip.currentUserid,bimFileterColoring.currentUsername=BimBdip.currentUsername,BimBdip.view.loadExtension("Autodesk.ADN.Viewing.Extension.Color")},hideColoringButtonFrame:function(){$(bimFileterColoring.btnColoring).removeClass("active"),$(bimFileterColoring.btnColoring).addClass("inactive"),bimFileterColoring.beVisibleToColoring=!1;BimBdip.view;bimFileterColoring.removeAllColors(),hideSidePanel(),window.parent.hideSidePanel()},dockingPanel:function(){bimViewPointNew&&bimViewPointNew.hiddenViewPoint_new()},showAllDbids:function(){for(var e=BimBdip.view.model.getFragmentList().fragments.fragId2dbId,i=0;i<e.length;i++)BimBdip.view.getColors(e[i],"#666666")},removeAllColors:function(){BimBdip.view.showAll();for(var e=BimBdip.view.model.getFragmentList().fragments.fragId2dbId,i=0;i<e.length;i++)null==BimBdip.view.restoreColorMaterial||"undefined"==BimBdip.view.restoreColorMaterial||BimBdip.view.restoreColorMaterial(parseInt(e[i]))},CustomDisplay:function(e){bimFileterColoring.removeColor(bimFileterColoring.currentDbid),bimFileterColoring.showAllDbids(),bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,1)},FilterResults:function(e){bimFileterColoring.removeColor(bimFileterColoring.currentDbid),bimFileterColoring.showAllDbids(),setTimeout(function(){bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,3)},1e3)},coloring_load:function(){$("#ffilter_coloring_box_bt ").innerHTML="",bimFileterColoring.dockingPanel(),bimFileterColoring.init(),bimFileterColoring.toggleVisibilityForColoring()},toggleVisibilityForColoring:function(){bimFileterColoring.setVisibleForColoring(!bimFileterColoring.beVisibleToColoring)},setVisibleForColoring:function(e){BimBdip.view;bimFileterColoring.beVisibleToColoring=e,bimFileterColoring.btnColoring.classList.toggle("active");if(e)bimFileterColoring.CustomDisplay(1),bimFileterColoring.showAllDbids();else{BimBdip.view.showAll();for(var i=BimBdip.view.model.getFragmentList().fragments.fragId2dbId,t=0;t<i.length;t++)BimBdip.view.restoreColorMaterial(parseInt(i[t]))}},insertDefaultData:function(){var e=new Date,i=e.getFullYear()+"/"+(e.getMonth()+1)+"/"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds(),t=new FormData;t.append("modelurl",bimFileterColoring.currentModelUrl),t.append("modelid",bimFileterColoring.currentModelid),t.append("username",bimFileterColoring.currentUsername),t.append("userid",bimFileterColoring.currentUserid),t.append("createTime",i);$.ajax({url:"../FilterColoring_insertDefaultData.action",data:t,type:"POST",dataType:"text",processData:!1,contentType:!1,success:function(e){bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,1)},error:function(){}})},selectAllByModelId:function(e,u){var i="../FilterColoring_selectAllByModelId.action?modelid="+e;$.ajax({type:"POST",async:!1,url:i,dataType:"json",success:function(e){bimFileterColoring.isFirst=!0;var i="";if(200==e.code){var t=e.data;if(0<t.length&&null!=t){for(var o=0;o<t.length;o++){var l="",r="";bimFileterColoring.childid=t[o].childid;var n=t[o].color,d=t[o].fname,a=t[o].id,c=t[o].modelUrl,s=t[o].modelid,g=t[o].filterResult;t[o].filterid;1==u&&"true"!=g&&"false"!=g?(i+="<tr  class='tr_"+a+"'>",i+="<td style='position: relative;width: 20px;'><i class='check_b'onclick='bimFileterColoring.isCheck(event)' style='display:block;float:left;width:16px;height:16px; background: url(img/modeltool/filtercoloring/deng.png) 0px 0px / 200%;cursor: pointer;position: absolute;top:2px;' _isChecked='false'></i><input style='display:none;' class='check_btn' type='checkbox' onchange='bimFileterColoring.onCheck(\""+bimFileterColoring.childid+'","'+n+'","customColor'+a+"\")' name='answer' value='"+bimFileterColoring.childid+","+n+"'  id='customColor"+a+"'/></td>",i+="<td class='table_name' title='"+d+"'>"+d+"</td>",i+="<td style='vertical-align: bottom;width:29%'><span class='color_input' style='margin: 0 auto;background:"+n+"'></span></td>",i+="<td><a href='#' onclick='bimFileterColoring.ColoringComponent(\""+bimFileterColoring.childid+'","'+n+'","'+d+"\")'>"+bdip4dLang[langType][-15283]+"</a></td>",i+="<td><a href='#' onclick='bimFileterColoring.CancelColoring(\""+bimFileterColoring.childid+'","'+c+'","'+s+'","'+n+"\")'>"+bdip4dLang[langType][-15284]+"</a></td>",i+="</tr>",$("#coloring-tbody").html(i)):2==u&&"true"!=g&&"false"!=g?(i+="<tr class='tr_"+a+"'>",i+="<td style='width:35%;' class='table_name' title='"+d+"' onClick='bimFileterColoring.updateFilterColorName(this,\""+bimFileterColoring.childid+'","'+a+'","'+s+"\")'>"+d+"</td>",i+="<td style='vertical-align: bottom;width:29%;'><span class='color_input' onclick=bimFileterColoring.colorSelect('nowColor','pageColorViews','event','updateColor',\""+bimFileterColoring.childid+'","'+s+"\") style='margin:0 auto;background:"+n+";'></span></td>",i+="<td style='width:30%;'><a style='margin:0 auto;' href='#' onclick='bimFileterColoring.deleteFileterColoring(\""+bimFileterColoring.childid+'","'+a+'","'+s+"\")'>"+bdip4dLang[langType][-15285]+"</a></td>",i+="</tr>",$("#editorColor-tbody").html(i)):3==u&&"true"==g?(i+="<tr  class='tr_"+a+"' style='width:100%;display:block;'>",i+="<td id='check' style='position: relative;width: 20px;vertical-align: top;'><i class='check_filter_b'onclick='bimFileterColoring.isCheck(event)' style='display:block;float:left;width:16px;height:16px;background: url(img/modeltool/filtercoloring/deng.png) 0px 0px / 200%;cursor: pointer;position: absolute;top:2px;' _isChecked='false'></i><input style='display:none;' class='check_btn' type='checkbox' onchange='bimFileterColoring.onCheck(\""+bimFileterColoring.childid+'","'+n+'","customColor'+a+"\")' name='answer' value='"+bimFileterColoring.childid+","+n+"'  id='customColor"+a+"'/></td>",i+="<td class='table_name filt_name' title='"+d+"'>"+d+"</td>",i+="<td style='vertical-align: bottom;width:25%;'><span class='color_input' style=background:"+n+";></span></td>",i+="</tr>",$("#filterResult-tbody").html(i)):4==u&&""!=g&&"undefined"!=g&&null!=g&&(i+="<tr  class='tr_"+a+"'>",i+="<td class='w_24' title='"+d+"' style='width:35%'>"+d+"</td>",i+="<td style='vertical-align: bottom;width: 34%;'><span class='color_input' onclick=bimFileterColoring.colorSelect('nowColor','pageColorViews','event','updateFilterResultColor',\""+bimFileterColoring.childid+'","'+s+"\") style='margin: 0 auto;background:"+n+";'></span></td>","false"==g?(l="",r="background:#0c92f3;text-shadow:none;color:#FFF"):(l="background:#0c92f3;text-shadow:none;color:#FFF",r=""),i+="<td><a style="+l+" href='#' onclick='bimFileterColoring.EnableFilterResults(\""+a+'","'+bimFileterColoring.childid+'","'+g+"\")'>"+bdip4dLang[langType][-15286]+"</a></td>",i+="<td><a class='' style="+r+" href='#' onclick='bimFileterColoring.CloseFileterResult(\""+a+'","'+bimFileterColoring.childid+'","'+g+"\")'>"+bdip4dLang[langType][-15287]+"</a></td>",i+="</tr>",$("#editorColor-filterResult--tbody").html(i))}if(1==bimFileterColoring.isFirst)""!=$("#coloring-tbody")[0].innerText||bimFileterColoring.insertDefaultData(),bimFileterColoring.isFirst=!1}else bimFileterColoring.insertDefaultData()}},error:function(e){}})},ColoringComponent:function(e,i,t){var o=BimBdip.view.getSelection();$("#ViewerModelStructurePanel");if(null!=o.length&&o.length!=[]){bimFileterColoring.getselectdbid=[];for(var l=0;l<BimBdip.view.getSelection().length;l++)bimFileterColoring.checkMenuDbid(BimBdip.view.getSelection()[l]);var r=new Date,n=r.getFullYear()+"/"+(r.getMonth()+1)+"/"+r.getDate()+" "+r.getHours()+":"+r.getMinutes()+":"+r.getSeconds(),d=t,a=bimFileterColoring.getselectdbid,c=e,s=bimFileterColoring.currentModelUrl,g=bimFileterColoring.currentModelid,u=bimFileterColoring.currentUsername,m=bimFileterColoring.currentUserid,b=new FormData;b.append("cname",d),b.append("dbid",a),b.append("gjid",c),b.append("modelurl",s),b.append("modelid",g),b.append("username",u),b.append("userid",m),b.append("color",i),b.append("createTime",n);$.ajax({url:"../FilterColoring_addGoujian.action",type:"POST",data:b,dataType:"text",processData:!1,contentType:!1,success:function(e){layer.msg(bdip4dLang[langType][-15290],{icon:1,time:1e3});for(var i,t,o=new Array,l=$(".check_btn"),r=0;r<l.length;r++)$(l[r]).is(":checked")&&(t=(i=$(l[r]).val()).split(",")[0],i.split(",")[1],o.push(t));0<o.length&&bimFileterColoring.showColoringDbid(o)},error:function(){}})}else layer.msg(bdip4dLang[langType][-15289],{icon:7,time:2e3})},checkMenuDbid:function(e){var i=!1;BimBdip.view.model.getData().instanceTree.enumNodeChildren(e,function(e){i=!0,bimFileterColoring.checkMenuDbid(e)}),i||bimFileterColoring.getselectdbid.push(e)},IsInArray:function(e,i){return-1!=(","+e.join(",")+",").indexOf(","+i+",")},deleteDbid:function(e){var i=!1;BimBdip.view.model.getData().instanceTree.enumNodeChildren(e,function(e){i=!0,bimFileterColoring.deleteDbid(e)}),i||bimFileterColoring.deletedbids.push(e)},CancelColoring:function(b,p,C,e){var f=[],h=[];bimFileterColoring.deletedbids=[];for(var i=0;i<BimBdip.view.getSelection().length;i++)bimFileterColoring.deleteDbid(BimBdip.view.getSelection()[i]);var F=bimFileterColoring.deletedbids,t=new FormData;t.append("gjid",b),t.append("cmodelid",C);$.ajax({url:"../FilterColoring_selectAllByGjid.action",type:"POST",data:t,dataType:"json",processData:!1,contentType:!1,async:!1,success:function(e){if(200==e.code){var i=e.data;if(0<BimBdip.view.getSelection().length){if(bimFileterColoring.currentDbid&&F){for(var t=0;t<i.length;t++){var o=i[t].dbid.split(",");h.push(o)}var l=[];for(t=0;t<h.length;-1===l.indexOf(h[t++])&&l.push(h[t-1]));var r=l+",";if(F&&0<F.length){for(t=0;t<F.length;t++){var n=F[t]+",";r=r.split(n).join("")}f=2<r.length?r.substring(0,r.length-1):""}var d=f.split(","),a={},c="";for(t=0;t<d.length;t++)""!=d[t]&&(a["a"+d[t]]=d[t]);for(var s in a)c+=","+a[s];var g=c.toString();","==g.substr(0,1)&&(g=g.substr(1));var u=new FormData;u.append("gjid",b),u.append("modelurl",p),u.append("modelid",C),u.append("dbid",g);var m=bdip4dLang[langType][-15294];Dialog.confirm(m,function(){$.ajax({url:"../FilterColoring_updateDbidByGjid.action",type:"POST",data:u,dataType:"json",processData:!1,contentType:!1,success:function(e){layer.msg(bdip4dLang[langType][-15295],{icon:1,time:1e3}),BimBdip.view.showAll(),bimFileterColoring.removeColor(bimFileterColoring.currentDbid),bimFileterColoring.showAllDbids();for(var i=[],t=$(".check_btn"),o=0;o<t.length;o++)if($(t[o]).is(":checked")){var l=$(t[o]).val(),r=l.split(",")[0];l.split(",")[1];i.push(r)}0<i.length&&bimFileterColoring.showColoringDbid(i)},error:function(e){}})})}}else layer.msg(bdip4dLang[langType][-15297],{icon:0,time:2e3})}},error:function(e){}})},removeRepeat:function(e){for(var i=e.split(","),t={},o=0;o<i.length;o++)""!=i[o]&&(t["a"+i[o]]=i[o]);var l="";for(var r in t)l+=","+t[r];var n=l.toString();return","==n.substr(0,1)&&(n=n.substr(1)),n},EditorColoring:function(){$(".filter_coloring_box_content").hide();var e="../FilterColoring_selectAllByModelId.action?modelid="+bimFileterColoring.currentModelid;$.ajax({type:"POST",url:e,dataType:"json",success:function(e){$("#editorColorbox").show();if(200==e.code){var i=e.data;if(0<i.length&&null!=i){setTimeout(function(){bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,2)},500)}}},error:function(e){}})},insertFileterColoring:function(e){var i=bimFileterColoring.randomWord(!0,16,32),t=new Date,o=t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate()+" "+t.getHours()+":"+t.getMinutes()+":"+t.getSeconds(),l=bdip4dLang[langType][-15299],r=new FormData;r.append("fname",l),r.append("childid",i),r.append("color",e),r.append("modelurl",bimFileterColoring.currentModelUrl),r.append("modelid",bimFileterColoring.currentModelid),r.append("username",bimFileterColoring.currentUsername),r.append("userid",bimFileterColoring.currentUserid),r.append("createTime",o);$.ajax({url:"../FilterColoring_insertFileterColoring.action",type:"POST",data:r,dataType:"text",processData:!1,contentType:!1,success:function(e){layer.msg(bdip4dLang[langType][-15300],{icon:1,time:1e3}),setTimeout(function(){bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,2)},500)},error:function(){}})},deleteFileterColoring:function(r,n,e){var i="../FilterColoring_selectAllByGjid.action?gjid="+r+"&modelid="+e,t=bdip4dLang[langType][-15302];Dialog.confirm(t,function(){$.ajax({url:i,type:"POST",dataType:"json",processData:!1,contentType:!1,success:function(e){if(200==e.code){var i=e.data;if(0<i.length&&null!=i.length){var t=i[0].dbid;if(null!=t&&""!=t&&t!=[]&&"null"!=t)return void layer.msg(bdip4dLang[langType][-15303],{icon:0,time:2e3});var o="../FilterColoring_deleteFileterColoring.action?id="+n+"&childid="+r;$.ajax({url:o,type:"GET",dataType:"text",processData:!1,contentType:!1,success:function(e){layer.msg(bdip4dLang[langType][-15304],{icon:1,time:1e3}),bimFileterColoring.removeColor(bimFileterColoring.currentDbid),bimFileterColoring.showAllDbids(),setTimeout(function(){bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,2)},500)},error:function(e){return!1}})}else{var l="../FilterColoring_deleteFileterColoring.action?id="+n+"&childid="+r;$.ajax({url:l,type:"GET",dataType:"text",processData:!1,contentType:!1,success:function(e){layer.msg(bdip4dLang[langType][-15304],{icon:1,time:1e3}),setTimeout(function(){bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,2)},500)},error:function(e){return!1}})}}},error:function(e){return!1}})})},ReturnCustom:function(){$("#colorBoard").remove(),$(".editorColorbox").hide(),$(".filter_coloring_box_content").show();setTimeout(function(){bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,1)},500)},selectFilterByLmvid:function(c,s){var e="../FilterColoring_selectFilterByLmvid.action?lmvid="+c;$.ajax({type:"POST",async:!1,url:e,dataType:"json",success:function(e){if("200"==e.code){var i=e.data;if(0<i.length&&null!=i)for(var t=0;t<i.length;t++){var o=i[t].id,l=i[t].conditionName,r=i[t].dbids,n=BimBdip.view_modelUrl,d=BimBdip.currentUsername,a=BimBdip.currentUserid;bimFileterColoring.insertEnableFilterColoring(o,s,l,r,n,c,d,a)}}},error:function(e){}})},insertEnableFilterColoring:function(e,i,t,o,l,r,n,d){var a=bimFileterColoring.randomWord(!0,16,32),c=new Date,s=c.getFullYear()+"/"+(c.getMonth()+1)+"/"+c.getDate()+" "+c.getHours()+":"+c.getMinutes()+":"+c.getSeconds(),g=new FormData;g.append("fname",t),g.append("childid",a),g.append("color","#00FFFF"),g.append("modelurl",l),g.append("modelid",r),g.append("username",n),g.append("userid",d),g.append("filterResult","false"),g.append("createTime",s),g.append("dbid",o),g.append("filterid",e),g.append("treeid",i);$.ajax({url:"../FilterColoring_insertEnableFilterColoring.action",async:!1,type:"POST",data:g,dataType:"text",processData:!1,contentType:!1,success:function(e){layer.msg(bdip4dLang[langType][-15300],{icon:1,time:1e3});bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,4)},error:function(){return!1}})},deleteFilterResultByFilterid:function(l){var e="../FilterColoring_selectFilterResultById.action?filterid="+l+"&modelid="+BimBdip.lvmid;$.ajax({type:"POST",async:!1,url:e,dataType:"json",success:function(e){if(200==e.code){var i=e.data;if(0<i.length&&null!=i){var t=i[0].childid,o="../FilterColoring_deleteFilterResultByFilterid.action?filterid="+l+"&modelid="+BimBdip.lvmid+"&childid="+t;$.ajax({url:o,type:"GET",dataType:"text",processData:!1,contentType:!1,success:function(e){layer.msg(bdip4dLang[langType][-15304],{icon:1,time:1e3});$("#editorColor-filterResult--tbody").html(""),bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,4),setTimeout(function(){$("#filterResult-tbody").html(""),bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,3)},1e3)},error:function(e){}})}}},error:function(e){}})},deleteFilterResultByTreeid:function(e){var i="../FilterColoring_deleteFilterResultByTreeid.action?treeid="+e+"&modelid="+BimBdip.lvmid;$.ajax({url:i,type:"GET",dataType:"text",processData:!1,contentType:!1,success:function(e){$("#editorColor-filterResult--tbody").html(""),setTimeout(function(){bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,4)},500),setTimeout(function(){$("#filterResult-tbody").html("");bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,3)},1500)},error:function(e){}})},updateFilterResultName:function(e,i){var t="../FilterColoring_updateFilterResultName.action?filterid="+e+"&modelid="+BimBdip.lvmid+"&fname="+i;$.ajax({url:t,type:"POST",dataType:"text",processData:!1,contentType:!1,success:function(e){bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,4),setTimeout(function(){bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,3)},1e3)},error:function(){}})},EnableFilterResults:function(e,i,t){if("true"!=t){var o="../FilterColoring_updateEnableFilterResults.action?id="+e+"&childid="+i+"&filterResult="+(t="true");$.ajax({url:o,type:"GET",dataType:"text",processData:!1,contentType:!1,async:!1,success:function(e){layer.msg(bdip4dLang[langType][-15308],{icon:1,time:1e3}),bimFileterColoring.removeColor(bimFileterColoring.currentDbid),bimFileterColoring.showAllDbids();bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,4)},error:function(){}})}else layer.msg(bdip4dLang[langType][-15307],{icon:0,time:1e3})},CloseFileterResult:function(e,i,t){if("false"!=t){var o="../FilterColoring_updateCloseFilterResults.action?id="+e+"&childid="+i+"&filterResult="+(t="false");$.ajax({type:"POST",url:o,processData:!1,contentType:!1,dataType:"text",success:function(e){layer.msg(bdip4dLang[langType][-15311],{icon:1,time:1e3}),bimFileterColoring.removeColor(bimFileterColoring.currentDbid),bimFileterColoring.showAllDbids();bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,4)},error:function(e){}})}else layer.msg(bdip4dLang[langType][-15310],{icon:0,time:2e3})},EditorTabtwoColoring:function(){$(".filter_coloring_box_content").hide();var e="../FilterColoring_selectAllByModelId.action?modelid="+bimFileterColoring.currentModelid;$.ajax({type:"GET",url:e,processData:!1,contentType:!1,dataType:"json",success:function(e){$("#editorColorbox_filterResult").show();if(200==e.code){var i=e.data;0<i.length&&null!=i&&bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,4)}},error:function(e){}})},ReturnFilterResults:function(){$("#editorColorbox_filterResult").hide(),$(".filter_coloring_box_content").show(),bimFileterColoring.removeColor(bimFileterColoring.currentDbid),bimFileterColoring.showAllDbids(),$("#filterResult-tbody").html("");bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,3)},updateFilterColorName:function(i,t,o,l){var r=i.innerHTML;if(!(0<r.indexOf('type="text"'))){var n=document.createElement("input");n.type="text",n.style="width:60px;height:20px",n.value=r,i.innerHTML="",i.appendChild(n),n.focus(),n.onblur=function(){if(i.innerHTML=this.value==r?r:this.value){var e="../FilterColoring_updateFilterColorName.action?childid="+t+"&fname="+n.value+"&id="+o+"&modelid="+l;$.ajax({url:e,type:"POST",dataType:"text",processData:!1,contentType:!1,success:function(e){setTimeout(function(){bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,2)},500)},error:function(){}})}}}},checkAllColors:function(e){var i=(e=e.srcElement?e.srcElement:e.target).getAttribute("_isChecked"),t=e.nextSibling;"false"==i?(e.style.backgroundPosition="18px",e.setAttribute("_isChecked","true"),e.nextSibling.checked=!0):(e.style.backgroundPosition="0px",e.setAttribute("_isChecked","false"),e.nextSibling.checked=!1),bimFileterColoring.checkAllColoring(t)},checkFileterAllColors:function(e){var i=(e=e.srcElement?e.srcElement:e.target).getAttribute("_isChecked"),t=e.nextSibling;"false"==i?(e.style.backgroundPosition="18px",e.setAttribute("_isChecked","true"),e.nextSibling.checked=!0):(e.style.backgroundPosition="0px",e.setAttribute("_isChecked","false"),e.nextSibling.checked=!1),bimFileterColoring.checkFilterAllColoring(t)},checkAllColoring:function(e){showMask("loading...");for(var i=new Array,t=e.closest("table"),o=$(t).find("input[name=answer]"),l=document.getElementsByClassName("check_b"),r=document.getElementsByClassName("check_btn_color")[0],n=0;n<o.length;n++)if(o[n].checked=e.checked,0==o[n].checked)r.style.backgroundPosition="0px",r.setAttribute("_isChecked","false"),l[n].style.backgroundPosition="0px",l[n].setAttribute("_isChecked","false"),BimBdip.view.showAll(),bimFileterColoring.removeColor(bimFileterColoring.currentDbid),bimFileterColoring.showAllDbids();else{r.style.backgroundPosition="18px",r.setAttribute("_isChecked","true"),l[n].style.backgroundPosition="18px",l[n].setAttribute("_isChecked","true");var d=o[n].value,a=d.split(",")[0];d.split(",")[1];i.push(a)}0<i.length?bimFileterColoring.showColoringDbid(i):0==$(":checkbox[name=answer]:checked").size()&&(BimBdip.view.showAll(),bimFileterColoring.showAllDbids(),$(".checkAll").checked=!1);hideMask()},checkFilterAllColoring:function(e){showMask("loading...");for(var i=e.closest("table"),t=$(i).find("input[name=answer]"),o=document.getElementsByClassName("check_filter_b"),l=document.getElementsByClassName("check_btn_color")[0],r=new Array,n=0;n<t.length;n++)if(t[n].checked=e.checked,0==t[n].checked)l.style.backgroundPosition="0px",l.setAttribute("_isChecked","false"),o[n].style.backgroundPosition="0px",o[n].setAttribute("_isChecked","false"),BimBdip.view.showAll(),bimFileterColoring.removeColor(bimFileterColoring.currentDbid),bimFileterColoring.showAllDbids();else{l.style.backgroundPosition="18px",l.setAttribute("_isChecked","true"),o[n].style.backgroundPosition="18px",o[n].setAttribute("_isChecked","true");var d=t[n].value,a=d.split(",")[0];d.split(",")[1];r.push(a)}0<r.length?bimFileterColoring.showColoringDbid(r):0==$(":checkbox[name=answer]:checked").size()&&(BimBdip.view.showAll(),bimFileterColoring.showAllDbids(),$(".checkAll").checked=!1);hideMask()},isCheck:function(e){"false"==(e=e.srcElement?e.srcElement:e.target).getAttribute("_isChecked")?(e.style.backgroundPosition="18px",e.setAttribute("_isChecked","true"),e.nextSibling.checked=!0):(e.style.backgroundPosition="0px",e.setAttribute("_isChecked","false"),e.nextSibling.checked=!1),bimFileterColoring.onCheck()},onCheck:function(){showMask("loading..."),bimFileterColoring.removeColor(bimFileterColoring.currentDbid),bimFileterColoring.showAllDbids();for(var e=$(".check_btn"),i=[],t=0;t<e.length;t++)if($(e[t]).is(":checked")){var o=$(e[t]).val(),l=o.split(",")[0];o.split(",")[1];i.push(l)}0<i.length?bimFileterColoring.showColoringDbid(i):0==$(":checkbox[name=answer]:checked").size()&&(BimBdip.view.showAll(),bimFileterColoring.showAllDbids(),$(".checkAll").checked=!1);hideMask()},showColoringDbid:function(e){var n=new Array;bimFileterColoring.dbidcheck=[];var i="../FilterColoring_selectAllByGjid.action?modelid="+bimFileterColoring.currentModelid+"&gjid="+e;$.ajax({url:i,type:"get",dataType:"json",async:!1,success:function(e){if(200==e.code){var i,t=e.data;if(!(0<t.length))return layer.msg(bdip4dLang[langType][-15298],{icon:7,time:2e3}),!1;for(var o=0;o<t.length;o++){bimFileterColoring.currentDbid+=t[o].dbid+",",i=t[o].dbid.split(",");for(var l=0;l<i.length;l++)n.push(i[l]);var r=t[o].compColor;if("undefined"!=r&&null!=r)for(l=0;l<i.length;l++)BimBdip.view.getColors(parseInt(i[l]),r),bimFileterColoring.dbidcheck.push(parseInt(i[l]))}if(BimBdip.checkRoomDbids(n),i[0]==[""]||"null"==i[0])return layer.msg(bdip4dLang[langType][-15298],{icon:7,time:2e3}),!1}},error:function(e){}})},removeColor:function(e){if(BimBdip.view.getColors(0,"#000000"),e)for(var i=e.split(","),t=0;t<i.length;t++)BimBdip.view.restoreColorMaterial(parseInt(i[t]));bimFileterColoring.currentDbid=""},dbidIsolate:function(e){if(e){for(var i=[],t=e.split(","),o=0;o<t.length;o++)t[o]&&i.push(parseInt(t[o]));BimBdip.view.isolate(i)}},hideNonColoring:function(){showMask("loading...");var e=document.getElementsByName("answer"),i=[];if(1==$(".checkHidden")[0].checked&&0==$(":checkbox[name=answer]:checked").size()){var t=BimBdip.view.model.getFragmentList().fragments.fragId2dbId;return BimBdip.view.isolate(t),void hideMask()}for(var o=0;o<e.length;o++)if(bimFileterColoring.checkName=$(e[o]).is(":checked"),1==$(".checkHidden")[0].checked){if(bimFileterColoring.checkName){var l=(n=e[o].value).split(",")[0];n.split(",")[1];i.push(l),bimFileterColoring.dbidIsolate(bimFileterColoring.currentDbid)}}else{if(BimBdip.view.showAll(),bimFileterColoring.removeColor(bimFileterColoring.currentDbid),bimFileterColoring.showAllDbids(),0==$(":checkbox[name=answer]:checked").size())return void hideMask();var r=$(".check_btn");for(o=0;o<r.length;o++)if($(r[o]).is(":checked")){var n;l=(n=$(r[o]).val()).split(",")[0],n.split(",")[1];i.push(l)}}bimFileterColoring.showColoringDbid(i),hideMask()},hideNonFilterColoring:function(){showMask("loading...");var e=document.getElementsByName("answer"),i=[];if(1==$(".checkHiddenFilter")[0].checked&&0==$(":checkbox[name=answer]:checked").size()){var t=BimBdip.view.model.getFragmentList().fragments.fragId2dbId;return BimBdip.view.isolate(t),void hideMask()}for(var o=0;o<e.length;o++)if(bimFileterColoring.checkName=$(e[o]).is(":checked"),1==$(".checkHiddenFilter")[0].checked){if(bimFileterColoring.checkName){var l=(n=e[o].value).split(",")[0];n.split(",")[1];return i.push(l),bimFileterColoring.dbidIsolate(bimFileterColoring.currentDbid),void hideMask()}}else{if(BimBdip.view.showAll(),bimFileterColoring.removeColor(bimFileterColoring.currentDbid),bimFileterColoring.showAllDbids(),0==$(":checkbox[name=answer]:checked").size())return void hideMask();var r=$(".check_btn");for(o=0;o<r.length;o++)if($(r[o]).is(":checked")){var n;l=(n=$(r[o]).val()).split(",")[0],n.split(",")[1];i.push(l)}}bimFileterColoring.showColoringDbid(i),hideMask()},showNonColoring:function(e){bimFileterColoring.dbidcheck=[];var i="../FilterColoring_selectAllByGjid.action?modelid="+bimFileterColoring.currentModelid+"&gjid="+e;$.ajax({url:i,type:"POST",dataType:"json",processData:!1,contentType:!1,async:!1,success:function(e){if(200==e.code)for(var i=e.data,t=0;t<i.length;t++){bimFileterColoring.currentDbid+=i[t].dbid+",";for(var o=i[t].dbid.split(","),l=i[t].compColor,r=0;r<o.length;r++){var n=parseInt(o[r]);NaN==n||""==n||"NaN"==n||BimBdip.view.getColors(n,l)}}},error:function(e){}})},doUpdateColor:function(e,i,t){var o="../FilterColoring_updateColor.action?color="+e.replace(/#/g,"")+"&childid="+i+"&modelid="+t;$.ajax({url:o,type:"POST",dataType:"text",processData:!1,contentType:!1,success:function(e){BimBdip.view.navigation.setRequestHomeView(!0),bimFileterColoring.removeColor(bimFileterColoring.currentDbid),bimFileterColoring.showAllDbids(),setTimeout(function(){bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,2)},500)},error:function(e){}})},doUpdateFilterResultColor:function(e,i,t){var o="../FilterColoring_updateColor.action?color="+e.replace(/#/g,"")+"&childid="+i+"&modelid="+t;$.ajax({url:o,type:"POST",dataType:"text",processData:!1,contentType:!1,success:function(e){BimBdip.view.navigation.setRequestHomeView(!0),bimFileterColoring.removeColor(bimFileterColoring.currentDbid),bimFileterColoring.showAllDbids(),setTimeout(function(){bimFileterColoring.selectAllByModelId(bimFileterColoring.currentModelid,4)},500)},error:function(e){}})},NewBuild:function(e){bimFileterColoring.colorSelect("nowColor","pageColorViews","event","newBuild")},NewBuildFilterResult:function(e){newBuildFilterResult="newBuildFilterResult",$(".filter_box").show(),filterExecute.modelAttributeTypes()},getScrollPos:function(){var e,i;return void 0!==window.pageYOffset?(e=window.pageYOffset,i=window.pageXOffset):(e=getBody().scrollTop,i=getBody().scrollLeft),{t:e,l:i}},getBody:function(){var e;return void 0!==document.compatMode&&"BackCompat"!=document.compatMode?e=document.documentElement:void 0!==document.body&&(e=document.body),e},formatRgb:function formatRgb(rgb){function checkFF(e){return 1==e.length?e=e+""+e:e}return rgb=rgb.replace("rgb",""),rgb=rgb.replace("(",""),rgb=rgb.replace(")",""),format=rgb.split(","),a=eval(format[0]).toString(16),b=eval(format[1]).toString(16),c=eval(format[2]).toString(16),rgb="#"+checkFF(a)+checkFF(b)+checkFF(c),rgb},colorSelect:function(e,t,o,l,r,n){if(!document.getElementById("colorBoard")){for(var d=getEvent(),c=d.target||d.srcElement,s=0,g=0;c;)s+=c.offsetTop,g+=c.offsetLeft,c=c.offsetParent;var u=g,m=s,p=bimFileterColoring.getScrollPos(),C=p.l+u,f=p.t+m+10;C>bimFileterColoring.getBody().clientWidth-320&&(C=bimFileterColoring.getBody().clientWidth-320);var h=document.getElementById(e),F=document.getElementById(t),y=new Array("00","33","66","99","CC","FF"),v=new Array("FF0000","00FF00","0000FF","FFFF00","00FFFF","FF00FF"),k=document.createElement("div");k.setAttribute("id","colorBank");var w=document.createElement("div");w.setAttribute("id","colorViews");var B=document.createElement("input");B.setAttribute("id","colorInput"),B.setAttribute("type","text"),B.setAttribute("disabled","disabled"),bimFileterColoring.colorClose=document.createElement("input"),bimFileterColoring.colorClose.setAttribute("id","colorClose"),bimFileterColoring.colorClose.setAttribute("value",bdip4dLang[langType][-15313]),bimFileterColoring.colorClose.setAttribute("type","button"),bimFileterColoring.colorClose.onclick=function(){document.body.removeChild(T)};var T=document.createElement("div");for(T.id="colorBoard",T.appendChild(w),T.appendChild(B),T.appendChild(bimFileterColoring.colorClose),T.appendChild(k),document.body.appendChild(T),T.style.left=C+"px",T.style.top=f+"px",document.body.clientHeight-300<f&&(T.style.top="auto",T.style.bottom="5%"),b=0;b<6;b++)for(a=0;a<3;a++)for(i=0;i<6;i++)colorItem=document.createElement("div"),colorItem.style.backgroundColor="#"+y[a]+y[i]+y[b],k.appendChild(colorItem);for(b=0;b<6;b++)for(a=3;a<6;a++)for(i=0;i<6;i++)colorItem=document.createElement("div"),colorItem.style.backgroundColor="#"+y[a]+y[i]+y[b],k.appendChild(colorItem);for(i=0;i<6;i++)colorItem=document.createElement("div"),colorItem.style.backgroundColor="#"+y[0]+y[0]+y[0],k.appendChild(colorItem);for(i=0;i<6;i++)colorItem=document.createElement("div"),colorItem.style.backgroundColor="#"+y[i]+y[i]+y[i],k.appendChild(colorItem);for(i=0;i<6;i++)colorItem=document.createElement("div"),colorItem.style.backgroundColor="#"+v[i],k.appendChild(colorItem);var x=k.getElementsByTagName("div");for(i=0;i<x.length;i++)x[i].onmouseover=function(){a=this.style.backgroundColor,7<a.length&&(a=bimFileterColoring.formatRgb(a)),w.style.background=a.toUpperCase(),B.value=a.toUpperCase()},x[i].onclick=function(){a=this.style.backgroundColor,7<a.length&&(a=bimFileterColoring.formatRgb(a)),h.value=a.toUpperCase(),colortext=h.value,F.style.background=a.toUpperCase(),"newBuild"==l?bimFileterColoring.insertFileterColoring(colortext):"updateFilterResultColor"==l?bimFileterColoring.doUpdateFilterResultColor(colortext,r,n):bimFileterColoring.doUpdateColor(colortext,r,n),document.body.removeChild(T)}}},randomWord:function(e,i,t){var o="",l=i,r=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"];e&&(l=Math.round(Math.random()*(t-i))+i);for(var n=0;n<l;n++)pos=Math.round(Math.random()*(r.length-1)),o+=r[pos];return o}};function getEvent(){if(document.all)return window.event;for(func=getEvent.caller;null!=func;){var e=func.arguments[0];if(e&&(e.constructor==Event||e.constructor==MouseEvent||"object"==(void 0===e?"undefined":_typeof(e))&&e.preventDefault&&e.stopPropagation))return e;func=func.caller}return null}$("#filter_coloring_tabs li").click(function(){var e=$(this).index();$(this).addClass("filter_coloring_current").siblings().removeClass("filter_coloring_current"),$("#filter_coloring_menu_content_box div.filter_coloring_menu_table").eq(e).show().siblings().hide()});