"use strict";var bimHistory={beShow:!1,beVisible:!1,btnElement:null,modelurl:null,dockingPanelNone:function(){var t=$(".markup");if(t&&0<t.length)for(var i=0;i<t.length;i++){t[i].style.display="none"}bimViewPointNew&&bimViewPointNew.hiddenViewPoint(),bimCollision&&hideButtonForClash()},init:function(){var t=BimBdip.view.getToolbar(!0).getControl("bimbdip_viewToolBar").getControl("bimbdip_button_history");bimHistory.btnElement=t.container},clean:function(){this.dockingPanelNone(),this.init(),bimHistory.beShow=!0,BimBdip.view.unloadExtension("Autodesk.ADN.Viewing.Extension.Markup",null),BimBdip.view.loadExtension("Autodesk.ADN.Viewing.Extension.Markup",null),bimViewPoint.mainPanel=BimBdip.view.loadedExtensions["Autodesk.ADN.Viewing.Extension.Markup"].getPanelObject()},doHistory:function(){toggleVisibilityForHistory()},showContent:function(t,i,e){$(".u-chat-list").hide(),$(".u-chat-hidden").show(),$(".u-chat-content").show(),$("#u-chat-aside-title-content").html(i+"  "+e),$("#u-chat-aside-title-content").attr({title:i+"  "+e}),$.ajax({type:"GET",url:publicJS.tomcat_url+"/getMessageByRoomId.action?room="+t,dataType:"json",success:function(t){if(200==t.code){for(var i=t.data,e="",n=0;n<i.length;n++){var o=i[n].sendContent.split("/nick"),s=i[n].sendTime.split(" ")[1].split(".")[0];2==o.length?(e+="<li onclick='bimHistory.clickOrdinaryMsg()'>",e+="\t<div class='g-chat-content'>",e+="\t\t<div class='g-chat-title'>",e+="\t\t\t<span>"+i[n].sendPerson+"进入房间</span>",e+="\t\t\t<span>"+s+"</span>",e+="\t\t</div>",e+="\t</div>",e+="</li>"):1==i[n].sendtype?(e+="<li onclick='bimHistory.clickOrdinaryMsg()'>",e+="\t<div class='g-chat-content'>",e+="\t\t<div class='g-chat-title'>",e+="\t\t\t<span>"+i[n].sendPerson+"</span>",e+="\t\t\t<span>"+s+"</span>",e+="\t\t</div>",e+="\t\t<div class='g-chat'>",e+="\t\t\t<b>"+i[n].sendContent+"</b>",e+="\t\t</div>",e+="\t</div>",e+="</li>"):2==i[n].sendtype&&(e+="<li class='shidian' onclick=\"bimHistory.loadViewPoint('"+i[n].sendContent+"')\">",e+="\t<div class='g-chat-content'>",e+="\t\t<div class='g-chat-title'>",e+="\t\t\t<span>"+i[n].sendPerson+"</span>",e+="\t\t\t<span>"+s+"</span>",e+="\t\t</div>",e+="\t\t<div class='g-chat'>",e+="\t\t\t<b>视点："+i[n].viewPointName+"</b>",e+="\t\t</div>",e+="\t</div>",e+="</li>")}$("#u-chat-content-ul").html(e)}},error:function(t){}})},loadViewPoint:function(t){showMask("loading..."),$.ajax({type:"GET",url:publicJS.tomcat_url+"/getViewPointByGuid.action?id="+t,dataType:"json",async:!1,success:function(t){if(null==t)return hideMask(),void Dialog.alert("该视点已被删除，无法查看");BimBdip.view.loadedExtensions["Autodesk.ADN.Viewing.Extension.Markup"].getDate(t)},error:function(t){hideMask()}})},clickOrdinaryMsg:function(){BimBdip.view.loadedExtensions["Autodesk.ADN.Viewing.Extension.Markup"].markupDown()},hiddenChatConten:function(){$(".u-chat-content").hide(),$("#u-chat-content-ul").html(""),$(".u-chat-list").show(),$(".u-chat-hidden").hide(),$("#u-chat-aside-title-content").html("历史会话列表")},closeChatAside:function(){setVisibleForHistory(!1)}};function setVisibleForHistory(t){bimHistory.beVisible=t,bimHistory.btnElement.classList.toggle("active"),t?(bimHistory.modelurl=BimBdip.view_modelUrl,$(".u-chat-aside").show(),$(".u-chat-hidden").hide(),$.ajax({type:"GET",url:publicJS.tomcat_url+"/getRoom.action?sessionId="+bimHistory.modelurl,dataType:"json",success:function(t){if(200==t.code){for(var i=t.data,e="",n=0;n<i.length;n++){var o=i[n].createTime.split(" ")[0];void 0===i[n].roomName||null===i[n].roomName||""===i[n].roomName||"null"===i[n].roomName||"undefined"===i[n].roomName?(e+="<li onclick='bimHistory.showContent("+i[n].id+',"无标题会话'+i[n].id+'","'+o+"\")'>",e+="<span class='chat-uname' title='无标题会话"+i[n].id+"'>无标题会话"+i[n].id+"</span>"):(e+="<li onclick='bimHistory.showContent("+i[n].id+',"'+i[n].roomName+'","'+o+"\")'>",e+="<span class='chat-uname' title='"+i[n].roomName+"'>"+i[n].roomName+"</span>"),e+="<span class='chat-time'>"+o+"</span>",e+="</li>"}$("#u-chat-list-ul").html(e)}},error:function(t){}})):($(".u-chat-aside").hide(),$(".u-chat-content").hide(),$(".u-chat-list").show(),$("#u-chat-aside-title-content").html("历史会话列表"),bimViewPoint&&bimViewPoint.mainPanel&&bimViewPoint.mainPanel.setVisible(!1),bimHistory.beShow=!1)}function toggleVisibilityForHistory(){setVisibleForHistory(!bimHistory.beVisible)}function hideButtonForHistory(){$(".u-chat-aside").hide(),$(".u-chat-content").hide(),$(".u-chat-list").show(),$("#u-chat-aside-title-content").html("历史会话列表"),bimViewPoint&&bimViewPoint.mainPanel&&bimViewPoint.mainPanel.setVisible(!1),bimHistory.beShow=!1,bimHistory.beVisible=!1,$(bimHistory.btnElement).removeClass("active"),$(bimHistory.btnElement).addClass("inactive")}function showButtonForHistory(){$(bimHistory.btnElement).removeClass("inactive"),$(bimHistory.btnElement).addClass("active")}